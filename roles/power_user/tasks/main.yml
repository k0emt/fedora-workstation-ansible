---
# tasks for power user role
- name: Install power user packages
  dnf:
    name:
      - btop
      - bat
      - curl
      - eza
      - fzf
      - htop
      - jq
      - mc
      - fastfetch
      - rsync
      - tldr
      - tmux
      - tree
      - unzip
      - wget
      - zip
    state: present

# task to install zsh
- name: Install zsh
  dnf:
    name: zsh
    state: present

# task to install oh-my-zsh
- name: Install Oh My Zsh
  ansible.builtin.git:
    repo: git@github.com:ohmyzsh/ohmyzsh.git
    dest: "{{ ansible_env.HOME }}/.oh-my-zsh"
    depth: 1

- name: Install zsh-autosuggestions plugin # noqa: latest
  ansible.builtin.git:
    repo: git@github.com:zsh-users/zsh-autosuggestions.git
    dest: "{{ ansible_env.HOME }}/.oh-my-zsh/custom/plugins/zsh-autosuggestions"
    depth: 1

- name: Install zsh-completions plugin # noqa: latest
  ansible.builtin.git:
    repo: git@github.com:zsh-users/zsh-completions.git
    dest: "{{ ansible_env.HOME }}/.oh-my-zsh/custom/plugins/zsh-completions"
    depth: 1

- name: Install zsh-syntax-highlighting plugin # noqa: latest
  ansible.builtin.git:
    repo: git@github.com:zsh-users/zsh-syntax-highlighting.git
    dest: "{{ ansible_env.HOME }}/.oh-my-zsh/custom/plugins/zsh-syntax-highlighting"
    depth: 1

- name: Change user shell to zsh 
  become: true
  ansible.builtin.user:
    name: "{{ ansible_user_id }}"
    shell: /bin/zsh

# task to install Powerlevel10k theme
- name: Install Powerlevel10k theme
  ansible.builtin.git:
    repo: git@github.com:romkatv/powerlevel10k.git
    dest: "{{ ansible_env.HOME }}/.oh-my-zsh/custom/themes/powerlevel10k"
    depth: 1

- name: Copy zshrc (for p10k)
  ansible.builtin.copy:
    src: zshrc-p10k
    dest: "{{ ansible_env.HOME }}/.zshrc"
    mode: 0644
  when: copy_dot_files

- name: Copy p10k.zsh
  ansible.builtin.copy:
    src: p10k.zsh
    dest: "{{ ansible_env.HOME }}/.p10k.zsh"
    mode: 0644
  when: copy_dot_files

# task to set Powerlevel10k theme in .zshrc
- name: Set Powerlevel10k theme in .zshrc
  lineinfile:
    path: "{{ ansible_env.HOME }}/.zshrc"
    regexp: '^ZSH_THEME='
    line: 'ZSH_THEME="powerlevel10k/powerlevel10k"'
  notify: reload zsh


# task to use oh-my-zsh plugins
- name: Use oh-my-zsh plugins
  lineinfile:
    path: "{{ ansible_env.HOME }}/.zshrc"
    regexp: '^plugins='
    line: 'plugins=(git aws web-search base64 zsh-autosuggestions zsh-syntax-highlighting)'
  notify: reload zsh

# handler to reload zsh configuration
- name: reload zsh
  command: zsh -ic "source {{ ansible_env.HOME }}/.zshrc"
  when: false

# task to set zsh as default shell
- name: Set zsh as default shell
  user:
    name: "{{ ansible_user }}"
    shell: /bin/zsh

# task to enable copr repository for IOSevka font
- name: Enable copr repository for IOSevka font
  command: dnf copr enable peterwu/iosevka
  become: true

# task to install IOSevka fonts
- name: Install IOSevka fonts
  dnf:
      name:
        - iosevka-fixed-ss04-fonts
        - iosevka-term-ss04-fonts
      state: present
  become: true

  # copy file static-content/vimrc to users ~/.vimrc
- name: Copy .vimrc to user's home directory
  copy:
    src: static-content/vimrc
    dest: "{{ ansible_env.HOME }}/.vimrc"
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    mode: 0644
