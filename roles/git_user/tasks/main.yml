---
# install git

- name: Install Git
  become: true
  dnf:
    name:
      - git
      - gitk
      - git-gui
    state: present

# tasks for configuring git

- name: Configure Git user name
  command: git config --global user.name "{{ git_user_name }}"

- name: Configure Git user email
  command: git config --global user.email "{{ git_user_email }}"

- name: Set default Git branch to main
  command: git config --global init.defaultBranch main

- name: Set default merge strategy to rebase
  command: git config --global pull.rebase true

# copy global-git-ignore.txt to users ~/.gitignore_global
- name: Copy global git ignore file
  copy:
    src: "{{ playbook_dir }}/global-git-ignore.txt"
    dest: "{{ ansible_env.HOME }}/.gitignore_global"

# set the global git ignore file
- name: Set global git ignore file
  command: git config --global core.excludesfile "{{ ansible_env.HOME }}/.gitignore_global"

# set up a directory for git repositories
- name: Create git projects directory
  file: path="{{ ansible_env.HOME }}/Projects" state=directory

# set up a directory for ssh keys
- name: Create .ssh directory
  file: path="{{ ansible_env.HOME }}/.ssh" state=directory

# Loop through the SSH key names and create keys
- name: Create new ssh keys
  command: ssh-keygen -t ed25519 -C "{{ git_user_email }}" -f "{{ ansible_env.HOME }}/.ssh/id_ed25519_{{ item.name }}" -N ""
  args:
    creates: "{{ ansible_env.HOME }}/.ssh/id_ed25519_{{ item.name }}"
  loop: "{{ ssh_keys }}"
